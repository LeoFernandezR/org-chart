!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-selection"),require("d3-array"),require("d3-hierarchy"),require("d3-zoom"),require("d3-flextree"),require("d3-shape")):"function"==typeof define&&define.amd?define(["exports","d3-selection","d3-array","d3-hierarchy","d3-zoom","d3-flextree","d3-shape"],e):e(t.d3=t.d3||{},t.d3,t.d3,t.d3,t.d3,t.d3,t.d3)}(this,function(t,e,a,n,i,r,o){"use strict";const u={selection:e.selection,select:e.select,max:a.max,min:a.min,sum:a.sum,cumsum:a.cumsum,tree:n.tree,stratify:n.stratify,zoom:i.zoom,zoomIdentity:i.zoomIdentity,linkHorizontal:o.linkHorizontal};t.OrgChart=class{constructor(){const a={id:"ID"+Math.floor(1e6*Math.random()),firstDraw:!0,svgWidth:800,svgHeight:window.innerHeight-100,scaleExtent:[.001,20],container:"body",defaultTextFill:"#2C3E50",defaultFont:"Helvetica",ctx:document.createElement("canvas").getContext("2d"),data:null,duration:400,setActiveNodeCentered:!0,expandLevel:1,compact:!0,rootMargin:40,nodeDefaultBackground:"none",connections:[],lastTransform:{x:0,y:0,k:1},nodeId:t=>t.nodeId||t.id,parentNodeId:t=>t.parentNodeId||t.parentId,backgroundColor:"none",zoomBehavior:null,defs:function(a,t){return`<defs>
                    ${t.map(t=>{var e=this.getTextWidth(t.label,{ctx:a.ctx,fontSize:2,defaultFont:a.defaultFont});return`
                       <marker id="${t.from+"_"+t.to}" refX="${t._source.x<t._target.x?-7:7}" refY="5" markerWidth="500"  markerHeight="500"  orient="${t._source.x<t._target.x?"auto":"auto-start-reverse"}" >
                       <rect rx=0.5 width=${t.label?e+3:0} height=3 y=1  fill="#152785"></rect>
                       <text font-size="2px" x=1 fill="white" y=3>${t.label||""}</text>
                       </marker>

                       <marker id="arrow-${t.from+"_"+t.to}"  markerWidth="500"  markerHeight="500"  refY="2"  refX="1" orient="${t._source.x<t._target.x?"auto":"auto-start-reverse"}" >
                       <path transform="translate(0)" d='M0,0 V4 L2,2 Z' fill='#152785' />
                       </marker>
                    `}).join("")}
                    </defs>
                    `},connectionsUpdate:function(t,e,a){u.select(this).attr("stroke",t=>"#152785").attr("stroke-linecap","round").attr("stroke-width",t=>"5").attr("pointer-events","none").attr("marker-start",t=>`url(#${t.from+"_"+t.to})`).attr("marker-end",t=>`url(#arrow-${t.from+"_"+t.to})`)},linkUpdate:function(t,e,a){u.select(this).attr("stroke",t=>t.data._upToTheRootHighlighted?"#152785":"lightgray").attr("stroke-width",t=>t.data._upToTheRootHighlighted?5:2),t.data._upToTheRootHighlighted&&u.select(this).raise()},nodeUpdate:function(t,e,a){u.select(this).select(".node-rect").attr("stroke",t=>t.data._highlighted||t.data._upToTheRootHighlighted?"#152785":"none").attr("stroke-width",t.data._highlighted||t.data._upToTheRootHighlighted?10:1)},nodeWidth:t=>250,nodeHeight:t=>150,siblingsMargin:t=>20,childrenMargin:t=>60,neightbourMargin:(t,e)=>80,compactMarginPair:t=>100,compactMarginBetween:t=>20,onNodeClick:t=>t,linkGroupArc:u.linkHorizontal().x(t=>t.x).y(t=>t.y),nodeContent:t=>`<div style="padding:5px;font-size:10px;">Sample Node(id=${t.id}), override using <br/> <br/> 
            <code>chart<br/>
            &nbsp;.nodeContent({data}=>{ <br/>
             &nbsp;&nbsp;&nbsp;&nbsp;return '' // Custom HTML <br/>
             &nbsp;})</code>
             <br/> <br/>
             Or check different <a href="https://github.com/bumbeishvili/org-chart#jump-to-examples" target="_blank">layout examples</a>
             
             </div>`,layout:"top",buttonContent:({node:t,state:e})=>{return`<div style="border-radius:3px;padding:3px;font-size:10px;margin:auto auto;background-color:lightgray"> ${{left:t=>t?'<div style="margin-top:-10px;line-height:1.2;font-size:25px;height:22px">‹</div>':'<div style="margin-top:-10px;font-size:25px;height:23px">›</div>',bottom:t=>t?'<div style="margin-top:-20px;font-size:25px">ˬ</div>':'<div style="margin-top:0px;line-height:1.2;height:11px;font-size:25px">ˆ</div>',right:t=>t?'<div style="margin-top:-10px;font-size:25px;height:23px">›</div>':'<div style="margin-top:-10px;line-height:1.2;font-size:25px;height:22px">‹</div>',top:t=>t?'<div style="margin-top:0px;line-height:1.2;height:11px;font-size:25px">ˆ</div>':'<div style="margin-top:-20px;font-size:25px">ˬ</div>'}[e.layout](t.children)}  </div>`},layoutBindings:{left:{nodeLeftX:t=>0,nodeRightX:t=>t.width,nodeTopY:t=>-t.height/2,nodeBottomY:t=>t.height/2,nodeJoinX:t=>t.x+t.width,nodeJoinY:t=>t.y-t.height/2,linkJoinX:t=>t.x+t.width,linkJoinY:t=>t.y,linkX:t=>t.x,linkY:t=>t.y,linkCompactXStart:t=>t.x+t.width/2,linkCompactYStart:t=>t.y+(t.compactEven?t.height/2:-t.height/2),compactLinkMidX:(t,e)=>t.firstCompactNode.x,compactLinkMidY:(t,e)=>t.firstCompactNode.y+t.firstCompactNode.flexCompactDim[0]/4+e.compactMarginPair(t)/4,linkParentX:t=>t.parent.x+t.parent.width,linkParentY:t=>t.parent.y,buttonX:t=>t.width,buttonY:t=>t.height/2,centerTransform:({rootMargin:t,centerY:e,scale:a})=>`translate(${t},${e}) scale(${a})`,compactDimension:{sizeColumn:t=>t.height,sizeRow:t=>t.width,reverse:t=>t.slice().reverse()},nodeFlexSize:({height:t,width:e,siblingsMargin:a,childrenMargin:n,state:i,node:o})=>{return i.compact&&o.flexCompactDim?[o.flexCompactDim[0],o.flexCompactDim[1]]:[t+a,e+n]},zoomTransform:({centerY:t,scale:e})=>`translate(0,${t}) scale(${e})`,diagonal:this.hdiagonal.bind(this),swap:t=>{var e=t.x;t.x=t.y,t.y=e},nodeUpdateTransform:({x:t,y:e,height:a})=>`translate(${t},${e-a/2})`},top:{nodeLeftX:t=>-t.width/2,nodeRightX:t=>t.width/2,nodeTopY:t=>0,nodeBottomY:t=>t.height,nodeJoinX:t=>t.x-t.width/2,nodeJoinY:t=>t.y+t.height,linkJoinX:t=>t.x,linkJoinY:t=>t.y+t.height,linkCompactXStart:t=>t.x+(t.compactEven?t.width/2:-t.width/2),linkCompactYStart:t=>t.y+t.height/2,compactLinkMidX:(t,e)=>t.firstCompactNode.x+t.firstCompactNode.flexCompactDim[0]/4+e.compactMarginPair(t)/4,compactLinkMidY:t=>t.firstCompactNode.y,compactDimension:{sizeColumn:t=>t.width,sizeRow:t=>t.height,reverse:t=>t},linkX:t=>t.x,linkY:t=>t.y,linkParentX:t=>t.parent.x,linkParentY:t=>t.parent.y+t.parent.height,buttonX:t=>t.width/2,buttonY:t=>t.height,centerTransform:({rootMargin:t,scale:e,centerX:a})=>`translate(${a},${t}) scale(${e})`,nodeFlexSize:({height:t,width:e,siblingsMargin:a,childrenMargin:n,state:i,node:o})=>{return i.compact&&o.flexCompactDim?[o.flexCompactDim[0],o.flexCompactDim[1]]:[e+a,t+n]},zoomTransform:({centerX:t,scale:e})=>`translate(${t},0}) scale(${e})`,diagonal:this.diagonal.bind(this),swap:t=>{},nodeUpdateTransform:({x:t,y:e,width:a})=>`translate(${t-a/2},${e})`},bottom:{nodeLeftX:t=>-t.width/2,nodeRightX:t=>t.width/2,nodeTopY:t=>-t.height,nodeBottomY:t=>0,nodeJoinX:t=>t.x-t.width/2,nodeJoinY:t=>t.y-t.height-t.height,linkJoinX:t=>t.x,linkJoinY:t=>t.y-t.height,linkCompactXStart:t=>t.x+(t.compactEven?t.width/2:-t.width/2),linkCompactYStart:t=>t.y-t.height/2,compactLinkMidX:(t,e)=>t.firstCompactNode.x+t.firstCompactNode.flexCompactDim[0]/4+e.compactMarginPair(t)/4,compactLinkMidY:t=>t.firstCompactNode.y,linkX:t=>t.x,linkY:t=>t.y,compactDimension:{sizeColumn:t=>t.width,sizeRow:t=>t.height,reverse:t=>t},linkParentX:t=>t.parent.x,linkParentY:t=>t.parent.y-t.parent.height,buttonX:t=>t.width/2,buttonY:t=>0,centerTransform:({rootMargin:t,scale:e,centerX:a,chartHeight:n})=>`translate(${a},${n-t}) scale(${e})`,nodeFlexSize:({height:t,width:e,siblingsMargin:a,childrenMargin:n,state:i,node:o})=>{return i.compact&&o.flexCompactDim?[o.flexCompactDim[0],o.flexCompactDim[1]]:[e+a,t+n]},zoomTransform:({centerX:t,scale:e})=>`translate(${t},0}) scale(${e})`,diagonal:this.diagonal.bind(this),swap:t=>{t.y=-t.y},nodeUpdateTransform:({x:t,y:e,width:a,height:n})=>`translate(${t-a/2},${e-n})`},right:{nodeLeftX:t=>-t.width,nodeRightX:t=>0,nodeTopY:t=>-t.height/2,nodeBottomY:t=>t.height/2,nodeJoinX:t=>t.x-t.width-t.width,nodeJoinY:t=>t.y-t.height/2,linkJoinX:t=>t.x-t.width,linkJoinY:t=>t.y,linkX:t=>t.x,linkY:t=>t.y,linkParentX:t=>t.parent.x-t.parent.width,linkParentY:t=>t.parent.y,buttonX:t=>0,buttonY:t=>t.height/2,linkCompactXStart:t=>t.x-t.width/2,linkCompactYStart:t=>t.y+(t.compactEven?t.height/2:-t.height/2),compactLinkMidX:(t,e)=>t.firstCompactNode.x,compactLinkMidY:(t,e)=>t.firstCompactNode.y+t.firstCompactNode.flexCompactDim[0]/4+e.compactMarginPair(t)/4,centerTransform:({rootMargin:t,centerY:e,scale:a,chartWidth:n})=>`translate(${n-t},${e}) scale(${a})`,nodeFlexSize:({height:t,width:e,siblingsMargin:a,childrenMargin:n,state:i,node:o})=>{return i.compact&&o.flexCompactDim?[o.flexCompactDim[0],o.flexCompactDim[1]]:[t+a,e+n]},compactDimension:{sizeColumn:t=>t.height,sizeRow:t=>t.width,reverse:t=>t.slice().reverse()},zoomTransform:({centerY:t,scale:e})=>`translate(0,${t}) scale(${e})`,diagonal:this.hdiagonal.bind(this),swap:t=>{var e=t.x;t.x=-t.y,t.y=e},nodeUpdateTransform:({x:t,y:e,width:a,height:n})=>`translate(${t-a},${e-n/2})`}}};this.getChartState=()=>a,Object.keys(a).forEach(e=>{this[e]=function(t){return arguments.length?(a[e]=t,this):a[e]}}),this.initializeEnterExitUpdatePattern()}initializeEnterExitUpdatePattern(){u.selection.prototype.patternify=function(t){var e=t.selector,a=t.tag,t=t.data||[e],t=this.selectAll("."+e).data(t,(t,e)=>"object"==typeof t&&t.id?t.id:e);return t.exit().remove(),(t=t.enter().append(a).merge(t)).attr("class",e),t}}getNodeChildren({data:t,children:e,_children:a},n){return n.push(t),e&&e.forEach(t=>{this.getNodeChildren(t,n)}),a&&a.forEach(t=>{this.getNodeChildren(t,n)}),n}initialZoom(t){return this.getChartState().lastTransform.k=t,this}render(){const o=this.getChartState();if(o.data&&0!=o.data.length){var t=u.select(o.container),e=t.node().getBoundingClientRect();0<e.width&&(o.svgWidth=e.width);const a={id:"ID"+Math.floor(1e6*Math.random()),chartWidth:o.svgWidth,chartHeight:o.svgHeight};(o.calc=a).centerX=a.chartWidth/2,a.centerY=a.chartHeight/2,o.firstDraw&&((e={zoom:null}).zoom=u.zoom().on("zoom",(t,e)=>this.zoomed(t,e)).scaleExtent(o.scaleExtent),o.zoomBehavior=e.zoom),o.flexTreeLayout=r.flextree({nodeSize:t=>{var e=o.nodeWidth(t),a=o.nodeHeight(t),n=o.siblingsMargin(t),i=o.childrenMargin(t);return o.layoutBindings[o.layout].nodeFlexSize({state:o,node:t,width:e,height:a,siblingsMargin:n,childrenMargin:i})}}).spacing((t,e)=>t.parent==e.parent?0:o.neightbourMargin(t,e)),this.setLayouts({expandNodesFirst:!1});e=t.patternify({tag:"svg",selector:"svg-chart-container"}).style("background-color",o.backgroundColor).attr("width",o.svgWidth).attr("height",o.svgHeight).attr("font-family",o.defaultFont),t=(o.firstDraw&&e.call(o.zoomBehavior).on("dblclick.zoom",null).attr("cursor","move"),(o.svg=e).patternify({tag:"g",selector:"chart"}));o.centerG=t.patternify({tag:"g",selector:"center-group"}),o.linksWrapper=o.centerG.patternify({tag:"g",selector:"links-wrapper"}),o.nodesWrapper=o.centerG.patternify({tag:"g",selector:"nodes-wrapper"}),o.connectionsWrapper=o.centerG.patternify({tag:"g",selector:"connections-wrapper"}),o.defsWrapper=e.patternify({tag:"g",selector:"defs-wrapper"}),o.firstDraw&&o.centerG.attr("transform",()=>o.layoutBindings[o.layout].centerTransform({centerX:a.centerX,centerY:a.centerY,scale:o.lastTransform.k,rootMargin:o.rootMargin,root:o.root,chartHeight:a.chartHeight,chartWidth:a.chartWidth})),o.chart=t,this.update(o.root),u.select(window).on("resize."+o.id,()=>{var t=u.select(o.container).node().getBoundingClientRect();o.svg.attr("width",t.width)}),o.firstDraw&&(o.firstDraw=!1)}else console.log("ORG CHART - Data is empty");return this}addNode(e){const a=this.getChartState();var t=a.allNodes.filter(({data:t})=>a.nodeId(t)===a.nodeId(e))[0],n=a.allNodes.filter(({data:t})=>a.nodeId(t)===a.parentNodeId(e))[0];return t?console.log(`ORG CHART - ADD - Node with id "${a.nodeId(e)}" already exists in tree`):n?(e._centered&&!e._expanded&&(e._expanded=!0),a.data.push(e),this.updateNodesState()):console.log(`ORG CHART - ADD - Parent node with id "${a.parentNodeId(e)}" not found in the tree`),this}removeNode(e){const a=this.getChartState();var t=a.allNodes.filter(({data:t})=>a.nodeId(t)==e)[0];return t?(t.descendants().forEach(t=>t.data._filteredOut=!0),this.getNodeChildren(t,[],a.nodeId).forEach(t=>t._filtered=!0),a.data=a.data.filter(t=>!t._filtered),this.updateNodesState.bind(this)()):console.log(`ORG CHART - REMOVE - Node with id "${e}" not found in the tree`),this}groupBy(t,a,e){const n={};return t.forEach(t=>{var e=a(t);n[e]||(n[e]=[]),n[e].push(t)}),Object.keys(n).forEach(t=>{n[t]=e(n[t])}),Object.entries(n)}calculateCompactFlexDimensions(t){const r=this.getChartState();t.eachBefore(t=>{t.firstCompact=null,t.compactEven=null,t.flexCompactDim=null,t.firstCompactNode=null}),t.eachBefore(t=>{if(t.children&&1<t.children.length){const n=t.children.filter(t=>!t.children);if(!(n.length<2)){n.forEach((t,e)=>{e||(t.firstCompact=!0),t.compactEven=!(e%2),t.row=Math.floor(e/2)});var e=u.max(n.filter(t=>t.compactEven),r.layoutBindings[r.layout].compactDimension.sizeColumn),a=u.max(n.filter(t=>!t.compactEven),r.layoutBindings[r.layout].compactDimension.sizeColumn);const i=2*Math.max(e,a);e=this.groupBy(n,t=>t.row,t=>u.max(t,t=>r.layoutBindings[r.layout].compactDimension.sizeRow(t)+r.compactMarginBetween(t)));const o=u.sum(e.map(t=>t[1]));n.forEach(t=>{t.firstCompactNode=n[0],t.firstCompact?t.flexCompactDim=[i+r.compactMarginPair(t),o-r.compactMarginBetween(t)]:t.flexCompactDim=[0,0]}),t.flexCompactDim=null}}})}calculateCompactFlexPositions(t){const r=this.getChartState();t.eachBefore(t=>{if(t.children){var e=t.children.filter(t=>t.flexCompactDim);const n=e[0];if(n){e.forEach((t,e,a)=>{0==e&&(n.x-=n.flexCompactDim[0]/2),e&e%2-1?t.x=n.x+.25*n.flexCompactDim[0]-r.compactMarginPair(t)/4:e&&(t.x=n.x+.75*n.flexCompactDim[0]+r.compactMarginPair(t)/4)});var a=n.x+.5*n.flexCompactDim[0];n.x=n.x+.25*n.flexCompactDim[0]-r.compactMarginPair(n)/4;const i=t.x-a;Math.abs(i)<10&&e.forEach(t=>t.x+=i);t=this.groupBy(e,t=>t.row,t=>u.max(t,t=>r.layoutBindings[r.layout].compactDimension.sizeRow(t)));const o=u.cumsum(t.map(t=>t[1]+r.compactMarginBetween(t)));e.forEach((t,e)=>{t.row?t.y=n.y+o[t.row-1]:t.y=n.y})}}})}update({x0:a,y0:n,x:i=0,y:o=0,width:r,height:d}){const l=this.getChartState();l.calc;l.compact&&this.calculateCompactFlexDimensions(l.root);var t=l.flexTreeLayout(l.root),e=(l.compact&&this.calculateCompactFlexPositions(l.root),t.descendants()),t=t.descendants().slice(1),s=(e.forEach(l.layoutBindings[l.layout].swap),l.connections);const h={},c=(l.allNodes.forEach(t=>h[l.nodeId(t.data)]=t),{});e.forEach(t=>c[l.nodeId(t.data)]=t),s.forEach(t=>{var e=h[t.from],a=h[t.to];t._source=e,t._target=a});var s=s.filter(t=>c[t.from]&&c[t.to]),g=l.defs.bind(this)(l,s),g=(g!==l.defsWrapper.html()&&l.defsWrapper.html(g),l.linksWrapper.selectAll("path.link").data(t,t=>l.nodeId(t.data))),t=g.enter().insert("path","g").attr("class","link").attr("d",t=>{var e={x:l.layoutBindings[l.layout].linkJoinX({x:a,y:n,width:r,height:d}),y:l.layoutBindings[l.layout].linkJoinY({x:a,y:n,width:r,height:d})};return l.layoutBindings[l.layout].diagonal(e,e,e)}).merge(g),t=(t.attr("fill","none"),t.each(l.linkUpdate),t.transition().duration(l.duration).attr("d",t=>{var e=l.compact&&t.flexCompactDim?{x:l.layoutBindings[l.layout].compactLinkMidX(t,l),y:l.layoutBindings[l.layout].compactLinkMidY(t,l)}:{x:l.layoutBindings[l.layout].linkX(t),y:l.layoutBindings[l.layout].linkY(t)},a={x:l.layoutBindings[l.layout].linkParentX(t),y:l.layoutBindings[l.layout].linkParentY(t)},t=l.compact&&t.flexCompactDim?{x:l.layoutBindings[l.layout].linkCompactXStart(t),y:l.layoutBindings[l.layout].linkCompactYStart(t)}:e;return l.layoutBindings[l.layout].diagonal(e,a,t)}),g.exit().transition().duration(l.duration).attr("d",t=>{var e={x:l.layoutBindings[l.layout].linkJoinX({x:i,y:o,width:r,height:d}),y:l.layoutBindings[l.layout].linkJoinY({x:i,y:o,width:r,height:d})};return l.layoutBindings[l.layout].diagonal(e,e)}).remove(),l.connectionsWrapper.selectAll("path.connection").data(s)),g=t.enter().insert("path","g").attr("class","connection").attr("d",t=>{var e={x:l.layoutBindings[l.layout].linkJoinX({x:a,y:n,width:r,height:d}),y:l.layoutBindings[l.layout].linkJoinY({x:a,y:n,width:r,height:d})};return l.layoutBindings[l.layout].diagonal(e,e)}).merge(t),s=(g.attr("fill","none"),g.transition().duration(l.duration).attr("d",t=>{var e=l.layoutBindings[l.layout].linkX({x:t._source.x,y:t._source.y,width:t._source.width,height:t._source.height}),a=l.layoutBindings[l.layout].linkY({x:t._source.x,y:t._source.y,width:t._source.width,height:t._source.height}),n=l.layoutBindings[l.layout].linkJoinX({x:t._target.x,y:t._target.y,width:t._target.width,height:t._target.height}),t=l.layoutBindings[l.layout].linkJoinY({x:t._target.x,y:t._target.y,width:t._target.width,height:t._target.height});return l.linkGroupArc({source:{x:e,y:a},target:{x:n,y:t}})}),g.each(l.connectionsUpdate),t.exit().transition().duration(l.duration).attr("opacity",0).remove(),l.nodesWrapper.selectAll("g.node").data(e,({data:t})=>l.nodeId(t))),g=s.enter().append("g").attr("class","node").attr("transform",t=>{return t==l.root?`translate(${a},${n})`:`translate(${l.layoutBindings[l.layout].nodeJoinX({x:a,y:n,width:r,height:d})},${l.layoutBindings[l.layout].nodeJoinY({x:a,y:n,width:r,height:d})})`}).attr("cursor","pointer").on("click",(t,{data:e})=>{[...t.srcElement.classList].includes("node-button-foreign-object")||l.onNodeClick(l.nodeId(e))}),t=(g.patternify({tag:"rect",selector:"node-rect",data:t=>[t]}),g.merge(s).style("font","12px sans-serif")),g=(t.patternify({tag:"foreignObject",selector:"node-foreign-object",data:t=>[t]}).style("overflow","visible").patternify({tag:"xhtml:div",selector:"node-foreign-object-div",data:t=>[t]}),this.restyleForeignObjectElements(),g.patternify({tag:"g",selector:"node-button-g",data:t=>[t]}).on("click",(t,e)=>this.onButtonClick(t,e))),g=(g.patternify({tag:"rect",selector:"node-button-rect",data:t=>[t]}).attr("opacity",0).attr("pointer-events","all").attr("width",40).attr("height",40).attr("x",-20).attr("y",-20),g.patternify({tag:"foreignObject",selector:"node-button-foreign-object",data:t=>[t]}).attr("width",40).attr("height",40).attr("x",-20).attr("y",-20).style("overflow","visible").patternify({tag:"xhtml:div",selector:"node-button-div",data:t=>[t]}).style("pointer-events","none").style("display","flex").style("width","100%").style("height","100%"),t.transition().attr("opacity",0).duration(l.duration).attr("transform",({x:t,y:e,width:a,height:n})=>l.layoutBindings[l.layout].nodeUpdateTransform({x:t,y:e,width:a,height:n})).attr("opacity",1),t.select(".node-rect").attr("width",({width:t})=>t).attr("height",({height:t})=>t).attr("x",({})=>0).attr("y",({})=>0).attr("cursor","pointer").attr("rx",3).attr("fill",l.nodeDefaultBackground),t.select(".node-button-g").attr("transform",({width:t,height:e})=>{return`translate(${l.layoutBindings[l.layout].buttonX({width:t,height:e})},${l.layoutBindings[l.layout].buttonY({width:t,height:e})})`}).attr("display",({data:t})=>0<t._directSubordinates?null:"none").attr("opacity",({children:t,_children:e})=>t||e?1:0),t.select(".node-button-foreign-object .node-button-div").html(t=>l.buttonContent({node:t,state:l})),t.select(".node-button-text").attr("text-anchor","middle").attr("alignment-baseline","middle").attr("fill",l.defaultTextFill).attr("font-size",({children:t})=>t?40:26).text(({children:t})=>t?"-":"+").attr("y",this.isEdge()?10:0),t.each(l.nodeUpdate),s.exit().attr("opacity",1).transition().duration(l.duration).attr("transform",t=>{return`translate(${l.layoutBindings[l.layout].nodeJoinX({x:i,y:o,width:r,height:d})},${l.layoutBindings[l.layout].nodeJoinY({x:i,y:o,width:r,height:d})})`}).on("end",function(){u.select(this).remove()}).attr("opacity",0),e.forEach(t=>{t.x0=t.x,t.y0=t.y}),l.allNodes.filter(t=>t.data._centered)[0]);g&&(t=g.data._centeredWithDescendants?g.descendants().filter((t,e)=>e<7):[g],g.data._centeredWithDescendants=null,g.data._centered=null,this.fit({animate:!0,scale:!1,nodes:t}))}isEdge(){return window.navigator.userAgent.includes("Edge")}hdiagonal(t,e,a){var n=t.x,t=t.y,i=e.x,e=e.y,o=a&&a.x||n,a=a&&a.y||t,r=i-n<0?-1:1,d=e-t<0?-1:1,l=Math.abs(i-n)/2<35?Math.abs(i-n)/2:35,l=Math.abs(e-t)/2<l?Math.abs(e-t)/2:l,s=(Math.abs(e-t),Math.abs(i-n)/2-l);return`
                  M ${o} ${a}
                  L ${o} ${t}
                  L ${n} ${t}
                  L ${n+s*r} ${t}
                  C ${n+s*r+l*r} ${t} 
                    ${n+s*r+l*r} ${t} 
                    ${n+s*r+l*r} ${t+l*d}
                  L ${n+s*r+l*r} ${e-l*d} 
                  C ${n+s*r+l*r}  ${e} 
                    ${n+s*r+l*r}  ${e} 
                    ${i-s*r}  ${e}
                  L ${i} ${e}
       `}diagonal(t,e,a){var n=t.x,t=t.y,i=e.x,e=e.y,o=a&&a.x||n,a=a&&a.y||t,r=i-n<0?-1:1,d=e-t<0?-1:1,l=Math.abs(i-n)/2<35?Math.abs(i-n)/2:35,l=Math.abs(e-t)/2<l?Math.abs(e-t)/2:l,s=Math.abs(e-t)/2-l;return`
                  M ${o} ${a}
                  L ${n} ${a}
                  L ${n} ${t}
                  L ${n} ${t+s*d}
                  C  ${n} ${t+s*d+l*d} ${n} ${t+s*d+l*d} ${n+l*r} ${t+s*d+l*d}
                  L ${n+(Math.abs(i-n)-2*l)*r+l*r} ${t+s*d+l*d}
                  C  ${i}  ${t+s*d+l*d} ${i}  ${t+s*d+l*d} ${i} ${e-s*d}
                  L ${i} ${e}
       `}restyleForeignObjectElements(){const n=this.getChartState();n.svg.selectAll(".node-foreign-object").attr("width",({width:t})=>t).attr("height",({height:t})=>t).attr("x",({})=>0).attr("y",({})=>0),n.svg.selectAll(".node-foreign-object-div").style("width",({width:t})=>t+"px").style("height",({height:t})=>t+"px").html(function(t,e,a){return n.nodeContent.bind(this)(t,e,a,n)})}onButtonClick(t,e){this.getChartState().setActiveNodeCentered&&(e.data._centered=!0,e.data._centeredWithDescendants=!0),e.children?(e._children=e.children,e.children=null,this.setExpansionFlagToChildren(e,!1)):(e.children=e._children,e._children=null,e.children&&e.children.forEach(({data:t})=>t._expanded=!0)),this.update(e)}setExpansionFlagToChildren({data:t,children:e,_children:a},n){t._expanded=n,e&&e.forEach(t=>{this.setExpansionFlagToChildren(t,n)}),a&&a.forEach(t=>{this.setExpansionFlagToChildren(t,n)})}expandSomeNodes(e){if(e.data._expanded){let t=e.parent;for(;t;)t._children&&(t.children=t._children),t=t.parent}e._children&&e._children.forEach(t=>this.expandSomeNodes(t)),e.children&&e.children.forEach(t=>this.expandSomeNodes(t))}updateNodesState(){var t=this.getChartState();this.setLayouts({expandNodesFirst:!0}),this.update(t.root)}setLayouts({expandNodesFirst:t=!0}){const o=this.getChartState();o.root=u.stratify().id(t=>o.nodeId(t)).parentId(t=>o.parentNodeId(t))(o.data),o.root.each((t,e,a)=>{var n=o.nodeWidth(t),i=o.nodeHeight(t);Object.assign(t,{width:n,height:i})}),o.root.x0=0,o.root.y0=0,o.allNodes=o.root.descendants(),o.allNodes.forEach(t=>{Object.assign(t.data,{_directSubordinates:t.children?t.children.length:0,_totalSubordinates:t.descendants().length-1})}),o.root.children&&(t&&o.root.children.forEach(this.expand),o.root.children.forEach(t=>this.collapse(t)),0==o.expandLevel&&(o.root._children=o.root.children,o.root.children=null),[o.root].forEach(t=>this.expandSomeNodes(t)))}collapse(t){t.children&&(t._children=t.children,t._children.forEach(t=>this.collapse(t)),t.children=null)}expand(t){t._children&&(t.children=t._children,t.children.forEach(t=>this.expand(t)),t._children=null)}zoomed(t,e){var a=this.getChartState(),n=a.chart,t=t.transform;a.lastTransform=t,n.attr("transform",t),this.isEdge()&&this.restyleForeignObjectElements()}zoomTreeBounds({x0:t,x1:e,y0:a,y1:n,params:i={animate:!0,scale:!0}}){var{centerG:o,svgWidth:r,svgHeight:d,svg:l,zoomBehavior:s,duration:h,lastTransform:c}=this.getChartState(),g=Math.min(8,.9/Math.max((e-t)/r,(n-a)/d));let p=u.zoomIdentity.translate(r/2,d/2);p=(p=p.scale(i.scale?g:c.k)).translate(-(t+e)/2,-(a+n)/2),l.transition().duration(i.animate?h:0).call(s.transform,p),o.transition().duration(i.animate?h:0).attr("transform","translate(0,0)")}fit({animate:t=!0,nodes:e,scale:a=!0}={}){const n=this.getChartState();var i=n["root"],e=e||i.descendants(),i=u.min(e,t=>t.x+n.layoutBindings[n.layout].nodeLeftX(t)),o=u.max(e,t=>t.x+n.layoutBindings[n.layout].nodeRightX(t)),r=u.min(e,t=>t.y+n.layoutBindings[n.layout].nodeTopY(t)),e=u.max(e,t=>t.y+n.layoutBindings[n.layout].nodeBottomY(t));return this.zoomTreeBounds({params:{animate:t,scale:a},x0:i-50,x1:o+50,y0:r-50,y1:e+50}),this}setExpanded(e,t=!0){const a=this.getChartState();var n=a.allNodes.filter(({data:t})=>a.nodeId(t)==e)[0];return n?n.data._expanded=t:console.log(`ORG CHART - ${t?"EXPAND":"COLLAPSE"} - Node with id (${e})  not found in the tree`),this}setCentered(e){const a=this.getChartState();var t=a.allNodes.filter(t=>a.nodeId(t.data)===e)[0];return t?(t.data._centered=!0,t.data._expanded=!0):console.log(`ORG CHART - CENTER - Node with id (${e}) not found in the tree`),this}setHighlighted(e){const a=this.getChartState();var t=a.allNodes.filter(t=>a.nodeId(t.data)===e)[0];return t?(t.data._highlighted=!0,t.data._expanded=!0,t.data._centered=!0):console.log(`ORG CHART - HIGHLIGHT - Node with id (${e})  not found in the tree`),this}setUpToTheRootHighlighted(e){const a=this.getChartState();var t=a.allNodes.filter(t=>a.nodeId(t.data)===e)[0];return t?(t.data._upToTheRootHighlighted=!0,t.data._expanded=!0,t.ancestors().forEach(t=>t.data._upToTheRootHighlighted=!0)):console.log(`ORG CHART - HIGHLIGHTROOT - Node with id (${e}) not found in the tree`),this}clearHighlighting(){var t=this.getChartState();t.allNodes.forEach(t=>{t.data._highlighted=!1,t.data._upToTheRootHighlighted=!1}),this.update(t.root)}fullscreen(t){const e=this.getChartState(),a=u.select(t||e.container).node();u.select(document).on("fullscreenchange."+e.id,function(t){(document.fullscreenElement||document.mozFullscreenElement||document.webkitFullscreenElement)==a?setTimeout(t=>{e.svg.attr("height",window.innerHeight-40)},500):e.svg.attr("height",e.svgHeight)}),a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen()}zoomIn(){var{svg:t,zoomBehavior:e}=this.getChartState();t.transition().call(e.scaleBy,1.3)}zoomOut(){var{svg:t,zoomBehavior:e}=this.getChartState();t.transition().call(e.scaleBy,.78)}toDataURL(t,e){var a=new XMLHttpRequest;a.onload=function(){var t=new FileReader;t.onloadend=function(){e(t.result)},t.readAsDataURL(a.response)},a.open("GET",t),a.responseType="blob",a.send()}exportImg({full:a=!1,scale:n=3,onLoad:i=t=>t,save:o=!0}={}){const r=this;const{svg:t,root:d}=this.getChartState();let e=0;var l=t.selectAll("img");let s=l.size();const h=()=>{JSON.parse(JSON.stringify(r.lastTransform()));var t=r.duration();a&&r.fit();const e=r.getChartState()["svg"];setTimeout(t=>{r.downloadImage({node:e.node(),scale:n,isSvg:!1,onAlreadySerialized:t=>{r.update(d)},onLoad:i,save:o})},a?t+10:0)};0<s?l.each(function(){r.toDataURL(this.src,t=>{this.src=t,++e==s&&h()})}):h()}exportSvg(){var t=this.getChartState()["svg"];return this.downloadImage({node:t.node(),scale:3,isSvg:!0}),this}expandAll(){var t=this.getChartState()["allNodes"];return t.forEach(t=>t.data._expanded=!0),this.render(),this}collapseAll(){var t=this.getChartState()["allNodes"];return t.forEach(t=>t.data._expanded=!1),this.expandLevel(0),this.render(),this}downloadImage({node:t,scale:e=2,isSvg:a=!1,save:n=!0,onAlreadySerialized:i=t=>{},onLoad:o=t=>{}}){const r=t;if(a)t='<?xml version="1.0" standalone="no"?>\r\n'+(t=s(r)),l(d="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(t),"graph.svg"),i();else{const h=e,c=document.createElement("img");c.onload=function(){var t=document.createElement("canvas"),e=r.getBoundingClientRect(),a=(t.width=e.width*h,t.height=e.height*h,t.getContext("2d")),a=(a.fillStyle="#FAFAFA",a.fillRect(0,0,e.width*h,e.height*h),a.drawImage(c,0,0,e.width*h,e.height*h),t.toDataURL("image/png"));o&&o(a),n&&l(a,"graph.png")};var d="data:image/svg+xml; charset=utf8, "+encodeURIComponent(s(r));function l(t,e){var a=document.createElement("a");"string"==typeof a.download?(document.body.appendChild(a),a.download=e,a.href=t,a.click(),document.body.removeChild(a)):location.replace(t)}function s(t){for(var e="http://www.w3.org/2000/xmlns/",a=(t=t.cloneNode(!0),window.location.href+"#"),n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,null,!1);n.nextNode();)for(const i of n.currentNode.attributes)i.value.includes(a)&&(i.value=i.value.replace(a,"#"));return t.setAttributeNS(e,"xmlns","http://www.w3.org/2000/svg"),t.setAttributeNS(e,"xmlns:xlink","http://www.w3.org/1999/xlink"),(new XMLSerializer).serializeToString(t)}i(),c.src=d}}getTextWidth(t,{fontSize:e=14,fontWeight:a=400,defaultFont:n="Helvetice",ctx:i}={}){return i.font=`${a||""} ${e}px ${n} `,i.measureText(t).width}},Object.defineProperty(t,"__esModule",{value:!0})});